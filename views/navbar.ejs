<div class="container-fluid bg-light">
  <div class="container p-2 d-flex align-items-center justify-content-between">
    <a href="/" alt="Booksy Logo"><img src="/logo.png" alt="Logo" style="width: auto; height: 75px" /></a>
    <form class="form-inline d-flex" id="search-form" method="GET">
      <input
        class="form-control"
        type="search"
        placeholder="Search"
        aria-label="Search"
        id="product-search"
        name="searchValue"
        style="border-radius: 0.375rem 0 0 0.375rem"
      />
      <button class="btn btn-outline-success" type="submit" style="border-radius: 0 0.375rem 0.375rem 0">Search</button>
    </form>
    <div>
      <a class="nav-link position-relative" href="/cart.html">
        <span
          class="badge rounded-pill bg-transparent text-primary position-absolute top-0 start-100 translate-middle"
          id="checkout-quantity"
        ></span>
        <i class="bi bi-bag lead"> </i>
      </a>
    </div>
  </div>
</div>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <ul class="navbar-nav mr-auto" id="link-list-nav">
      <% navLinks.forEach(function(link) { %>
      <li class="nav-item">
        <a class="nav-link text-muted" href="<%= link.url %>"><%= link.title %></a>
      </li>
      <% }); %>
    </ul>
  </div>
</nav>

<script defer>
  const fetch_cart = () => {
    const cartId = localStorage.getItem("cartId");

    if (cartId) {
      console.log("Fetching cart", cartId);

      fetch(`/cart?cartId=${cartId}`, { method: "GET" })
        .then((response) => response.json())
        .then((data) => {
          const totalItems = data.items.reduce((previous, current) => {
            previous += current.quantity;
            return previous;
          }, 0);

          console.log("total Items", totalItems);

          document.getElementById("checkout-quantity").textContent = totalItems;
        })
        .catch((error) => {
          console.error("Error:", error);
        });
    }
  };

  document.addEventListener("DOMContentLoaded", (event) => {
    console.log("DOM fully loaded and parsed");
    fetch_cart();
  });
</script>
